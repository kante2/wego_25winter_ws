<?xml version="1.0"?>
<launch>
    <!-- 
    Launch file for parking mission with ArUco detection
    Starts: ArUco detector + Parking-enabled lane following
    -->

    <!-- Arguments -->
    <arg name="publish_cmd_vel" default="true" 
         doc="Whether to publish motor commands directly"/>
    <arg name="debug_view" default="true" 
         doc="Whether to publish debug visualization topics"/>
    
    <!-- Obstacle parameters -->
    <arg name="obstacle_safe_distance" default="0.5" 
         doc="Distance (m) to start slowing down for obstacles"/>
    <arg name="obstacle_stop_distance" default="0.5" 
         doc="Distance (m) for emergency stop"/>
    <arg name="lidar_roi_angle" default="30.0" 
         doc="LiDAR ROI angle in degrees (Â±angle from front)"/>
    
    <!-- Obstacle avoidance parameters -->
    <arg name="avoidance_gain" default="0.6" 
         doc="Weight for obstacle avoidance angle (0.0~1.0)"/>
    <arg name="num_sectors" default="9" 
         doc="Number of sectors to divide LiDAR ROI"/>
    
    <!-- Parking parameters -->
    <arg name="parking_speed_slow" default="0.4" 
         doc="Slow forward speed for parking"/>
    <arg name="parking_speed_reverse" default="-0.4" 
         doc="Reverse speed for parking"/>
    <arg name="parking_steering_angle" default="0.5" 
         doc="Maximum steering angle for parking"/>
    
    <arg name="parking_forward_time" default="1.5" 
         doc="Time for forward pass (seconds)"/>
    <arg name="parking_reverse_right_time" default="3.0" 
         doc="Time for reverse with right turn (seconds)"/>
    <arg name="parking_reverse_left_time" default="0.01" 
         doc="Time for reverse with left turn (seconds)"/>
    <arg name="parking_final_forward_time" default="0.01" 
         doc="Time for final forward adjustment (seconds)"/>
    
    <arg name="parking_stop_before_sec" default="1.0" 
         doc="Initial stop duration before parking (seconds)"/>
    <arg name="parking_stop_align_sec" default="1.0" 
         doc="Stop duration for alignment (seconds)"/>
    
    <arg name="parking_trigger_distance" default="0.6" 
         doc="Distance to ArUco marker to trigger parking (meters)"/>
    <arg name="parking_target_marker_id" default="0" 
         doc="Target ArUco marker ID for parking"/>
    
    <arg name="aruco_marker_info_topic" default="/webot/aruco/marker_info" 
         doc="Topic for ArUco marker information"/>

    <!-- ArUco Detector Node -->
    <node pkg="perception_wego" 
          type="aruco_detector_node.py" 
          name="aruco_detector" 
          output="screen">
        <!-- ArUco parameters will be loaded from the node -->
    </node>

    <!-- Parking-enabled Lane Following Node -->
    <node pkg="decision_wego" 
          type="only_one_webot_parking.py" 
          name="only_one_webot_parking" 
          output="screen">
        
        <!-- Control Parameters -->
        <param name="publish_cmd_vel" value="$(arg publish_cmd_vel)"/>
        <param name="debug_view" value="$(arg debug_view)"/>
        
        <!-- Obstacle Detection Parameters -->
        <param name="obstacle_safe_distance" value="$(arg obstacle_safe_distance)"/>
        <param name="obstacle_stop_distance" value="$(arg obstacle_stop_distance)"/>
        <param name="lidar_roi_angle" value="$(arg lidar_roi_angle)"/>
        <param name="avoidance_gain" value="$(arg avoidance_gain)"/>
        <param name="num_sectors" value="$(arg num_sectors)"/>
        
        <!-- Parking Parameters -->
        <param name="parking_speed_slow" value="$(arg parking_speed_slow)"/>
        <param name="parking_speed_reverse" value="$(arg parking_speed_reverse)"/>
        <param name="parking_steering_angle" value="$(arg parking_steering_angle)"/>
        
        <param name="parking_forward_time" value="$(arg parking_forward_time)"/>
        <param name="parking_reverse_right_time" value="$(arg parking_reverse_right_time)"/>
        <param name="parking_reverse_left_time" value="$(arg parking_reverse_left_time)"/>
        <param name="parking_final_forward_time" value="$(arg parking_final_forward_time)"/>
        
        <param name="parking_stop_before_sec" value="$(arg parking_stop_before_sec)"/>
        <param name="parking_stop_align_sec" value="$(arg parking_stop_align_sec)"/>
        
        <param name="parking_trigger_distance" value="$(arg parking_trigger_distance)"/>
        <param name="parking_target_marker_id" value="$(arg parking_target_marker_id)"/>
        
        <param name="aruco_marker_info_topic" value="$(arg aruco_marker_info_topic)"/>
        
    </node>

</launch>
