<?xml version="1.0"?>
<launch>
    <!-- 
    WEGO Decision All Nodes Launch File
    - Main Decision Node (coordinates Lane, Obstacle, Parking missions)
    -->

    <!-- Main Decision Node -->
    <node pkg="decision_wego" type="main_node.py" name="wego_main_decision" 
          output="screen" respawn="false">
        <!-- Motor control topic -->
        <param name="~cmd_topic" value="/low_level/ackermann_cmd_mux/input/navigation"/>
        
        <!-- Update rate (Hz) -->
        <param name="~rate_hz" value="20.0"/>
        
        <!-- Traffic stop topic for override -->
        <param name="~traffic_stop_topic" value="/webot/traffic_stop"/>
        
        <!-- Lane Mission Parameters (Ver2 - BEV + Curvature) -->
        <param name="~lane/center_point_topic" value="/webot/lane_center_px"/>
        <param name="~lane/curvature_topic" value="/webot/lane_curvature"/>
        <param name="~lane/bev_center_x_px" value="320.0"/>
        <param name="~lane/steer_gain_base" value="1.5"/>
        <param name="~lane/steer_gain_min" value="0.8"/>
        <param name="~lane/steer_gain_max" value="2.0"/>
        <param name="~lane/pid_kp" value="0.02"/>
        <param name="~lane/pid_ki" value="0.0"/>
        <param name="~lane/pid_kd" value="0.001"/>
        <param name="~lane/pid_weight" value="0.3"/>
        <param name="~lane/base_speed_mps" value="0.3"/>
        <param name="~lane/min_speed_mps" value="0.1"/>
        <param name="~lane/timeout_sec" value="1.0"/>
        
        <!-- Obstacle Mission Parameters -->
        <param name="~obstacle/gap_angle_topic" value="/webot/obstacle/gap_angle"/>
        <param name="~obstacle/gap_width_topic" value="/webot/obstacle/gap_width"/>
        <param name="~obstacle/min_distance_topic" value="/webot/obstacle/min_distance"/>
        <param name="~obstacle/lane_steering_topic" value="/webot/steering_offset"/>
        <param name="~obstacle/lane_speed_topic" value="/webot/lane_speed"/>
        <param name="~obstacle/safe_distance" value="0.7"/>
        <param name="~obstacle/stop_distance" value="0.15"/>
        <param name="~obstacle/avoid_speed" value="0.25"/>
        <param name="~obstacle/max_steering" value="0.6"/>
        <param name="~obstacle/steering_gain" value="0.035"/>
        <param name="~obstacle/clear_threshold" value="20"/>
        
        <!-- Parking Mission Parameters -->
        <param name="~parking/aruco_marker_info_topic" value="/webot/aruco/marker_info"/>
        <param name="~parking/lane_steering_topic" value="/webot/steering_offset"/>
        <param name="~parking/lane_speed_topic" value="/webot/lane_speed"/>
        <param name="~parking/target_marker_id" value="0"/>
        <param name="~parking/trigger_distance" value="0.5"/>
        <param name="~parking/speed_slow" value="0.15"/>
        <param name="~parking/speed_reverse" value="-0.13"/>
        <param name="~parking/steering_angle" value="0.5"/>
        <param name="~parking/forward_time" value="1.5"/>
        <param name="~parking/reverse_right_time" value="3.0"/>
        <param name="~parking/reverse_left_time" value="3.0"/>
        <param name="~parking/final_forward_time" value="1.0"/>
        <param name="~parking/stop_before_sec" value="1.0"/>
        <param name="~parking/stop_align_sec" value="1.0"/>

        <!-- Crosswalk Mission Parameters -->
        <param name="~crosswalk/road_width_topic" value="/webot/road_width"/>
        <param name="~crosswalk/lane_steering_topic" value="/webot/steering_offset"/>
        <param name="~crosswalk/lane_speed_topic" value="/webot/lane_speed"/>
        <param name="~crosswalk/speed_slow" value="0.1"/>
        <param name="~crosswalk/speed_forward" value="0.15"/>
        <param name="~crosswalk/speed_back" value="-0.1"/>
        <param name="~crosswalk/steer_left" value="0.3"/>
        <param name="~crosswalk/steer_right" value="-0.3"/>
        <param name="~crosswalk/steer_forward" value="0.0"/>
        <param name="~crosswalk/time_forward_before" value="0.5"/>
        <param name="~crosswalk/time_stop_before" value="0.5"/>
        <param name="~crosswalk/time_forward_across" value="2.5"/>
        <param name="~crosswalk/time_stop_after" value="0.5"/>
        <param name="~crosswalk/time_back_return" value="2.5"/>
        
        <!-- Traffic Light Mission Parameters -->
        <param name="~traffic_light/traffic_light_state_topic" value="/webot/traffic_light/state"/>
        <param name="~traffic_light/lane_steering_topic" value="/webot/steering_offset"/>
        <param name="~traffic_light/lane_speed_topic" value="/webot/lane_speed"/>
        <param name="~traffic_light/speed_slow" value="0.3"/>
        <param name="~traffic_light/speed_zero" value="0.0"/>
        <param name="~traffic_light/steer_straight" value="0.0"/>
        <param name="~traffic_light/stop_hold_time" value="0.5"/>
    </node>

</launch>
